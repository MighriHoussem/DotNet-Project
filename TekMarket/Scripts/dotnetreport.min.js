/// .Net Report Builder view model v2.0.0
/// License has to be purchased for use
/// 2015-2017 (c) www.dotnetreport.com

function pagerViewModel(e){e=e||{};var o=this;o.pageSize=ko.observable(e.pageSize||30),o.pages=ko.observable(e.pages||1),o.currentPage=ko.observable(e.currentPage||1),o.pauseNavigation=ko.observable(!1),o.totalRecords=ko.observable(0),o.sortColumn=ko.observable(),o.sortDescending=ko.observable(),o.isFirstPage=ko.computed(function(){return 1==this.currentPage()},o),o.isLastPage=ko.computed(function(){return this.currentPage()==this.pages()},o),o.currentPage.subscribe(function(e){e>o.pages()&&o.currentPage(0==o.pages()?1:o.pages()),e<1&&o.currentPage(1)}),o.previous=function(){o.pauseNavigation()||o.isFirstPage()||isNaN(o.currentPage())||o.currentPage(Number(o.currentPage())-1)},o.next=function(){o.pauseNavigation()||o.isLastPage()||isNaN(o.currentPage())||o.currentPage(Number(o.currentPage())+1)},o.first=function(){o.pauseNavigation()||o.currentPage(1)},o.last=function(){o.pauseNavigation()||o.currentPage(o.pages())},o.changeSort=function(e){o.sortColumn()==e?o.sortDescending(!o.sortDescending()):o.sortDescending(!1),o.sortColumn(e),1!=o.currentPage()&&o.currentPage(1)}}var reportViewModel=function(e){var o=this;(e=e||{}).userId=e.userId||"",o.ReportName=ko.observable(),o.ReportType=ko.observable("List"),o.ReportDescription=ko.observable(),o.FolderID=ko.observable(),o.ReportID=ko.observable(),o.Tables=ko.observableArray([]),o.SelectedTable=ko.observable(),o.ChooseFields=ko.observableArray([]),o.ChosenFields=ko.observableArray([]),o.SelectedFields=ko.observableArray([]),o.SelectFields=ko.observableArray([]),o.SelectedField=ko.observable(),o.AdditionalSeries=ko.observableArray([]),o.IncludeSubTotal=ko.observable(!1),o.ShowUniqueRecords=ko.observable(!1),o.AggregateReport=ko.observable(!1),o.SortByField=ko.observable(),o.Filters=ko.observableArray([]),o.SaveReport=ko.observable(!0),o.ShowDataWithGraph=ko.observable(!0),o.ShowOnDashboard=ko.observable(!1),o.ReportMode=ko.observable(e.reportMode||"start"),o.Folders=ko.observableArray(),o.SavedReports=ko.observableArray([]),o.SelectedFolder=ko.observable(null),o.CanSaveReports=ko.observable(!0),o.CanManageFolders=ko.observable(!0),o.ReportResult=ko.observable({HasError:ko.observable(!1),ReportDebug:ko.observable(!1),Exception:ko.observable(),Warnings:ko.observable(),ReportSql:ko.observable(),ReportData:ko.observable(null)}),o.pager=new pagerViewModel,o.currentSql=ko.observable(),o.currentConnectKey=ko.observable(),o.pager.currentPage.subscribe(function(){o.ExecuteReportQuery(o.currentSql(),o.currentConnectKey())}),o.createNewReport=function(){o.clearReport(),o.ReportMode("generate")},o.ReportType.subscribe(function(e){"List"==e?o.AggregateReport(!1):o.AggregateReport(!0)}),o.setReportType=function(e){o.ReportType(e)},o.cancelCreateReport=function(){bootbox.confirm("Are you sure you would like to cancel editing this Report?",function(r){r&&(o.clearReport(),e.reportWizard.modal("hide"),o.ReportMode("start"))})},o.FlyFilters=ko.computed(function(){return $.grep(o.Filters(),function(e){return e.IsFilterOnFly})}),o.enabledFields=ko.computed(function(){return $.grep(o.SelectedFields(),function(e){return!e.disabled()})}),o.ManageFolder={FolderName:ko.observable(),IsNew:ko.observable(!1),newFolder:function(){o.ManageFolder.IsNew(!0),o.ManageFolder.FolderName(""),$("#folderModal").modal("show")},editFolder:function(){null!=o.SelectedFolder()?0!=o.SelectedFolder().Id?(o.ManageFolder.IsNew(!1),o.ManageFolder.FolderName(o.SelectedFolder().FolderName),$("#folderModal").modal("show")):toastr.error("Cannot edit Default folder"):toastr.error("Please choose a folder first")},saveFolder:function(){if(""!=o.ManageFolder.FolderName()){var r=o.ManageFolder.IsNew()?0:o.SelectedFolder().Id;if(0!=$.grep(o.Folders(),function(e){return e.FolderName.toLowerCase()==o.ManageFolder.FolderName().toLowerCase()&&(0==r||0!=r&&e.Id!=r)}).length)return toastr.error("Folder name is already in use, please choose a different Folder Name"),!1;ajaxcall({url:e.apiUrl+"/ReportApi/SaveFolder",data:{account:e.accountApiToken,dataConnect:e.dataconnectApiToken,clientId:e.clientId,folderId:r,folderName:o.ManageFolder.FolderName(),userId:e.userId}}).done(function(e){if(o.ManageFolder.IsNew())o.Folders.push({Id:e,FolderName:o.ManageFolder.FolderName()});else{var r=o.SelectedFolder();o.Folders.remove(o.SelectedFolder()),r.FolderName=o.ManageFolder.FolderName(),o.Folders.push(r)}$("#folderModal").modal("hide")})}else toastr.error("Please enter a Folder Name")},deleteFolder:function(){null!=o.SelectedFolder()?0!=o.SelectedFolder().Id?bootbox.confirm("Are you sure you want to delete this Folder?\n\nWARNING: Deleting a folder will delete all reports and this action cannot be undone.",function(r){r&&ajaxcall({url:e.apiUrl+"/ReportApi/DeleteFolder",data:{account:e.accountApiToken,dataConnect:e.dataconnectApiToken,clientId:e.clientId,folderId:o.SelectedFolder().Id,userId:e.userId}}).done(function(){o.Folders.remove(o.SelectedFolder()),o.SelectedFolder(null)})}):toastr.error("Cannot delete Default folder"):toastr.error("Please choose a folder first")}},o.reportsInFolder=ko.computed(function(){return null==o.SelectedFolder()?[]:$.grep(o.SavedReports(),function(e){return e.folderId==o.SelectedFolder().Id})}),o.clearReport=function(){o.ReportName(""),o.ReportDescription(""),o.ReportType("List"),o.FolderID(null==o.SelectedFolder()?0:o.SelectedFolder().Id),o.ChosenFields([]),o.SelectedFields([]),o.SelectFields([]),o.SelectedField(null),o.IncludeSubTotal(!1),o.ShowUniqueRecords(!1),o.AggregateReport(!1),o.SortByField(null),o.Filters([]),o.ReportID(0),o.SaveReport(o.CanSaveReports())},o.SelectedTable.subscribe(function(r){null!=r?ajaxcall({url:e.apiUrl+"/ReportApi/GetFields",data:{account:e.accountApiToken,dataConnect:e.dataconnectApiToken,clientId:e.clientId,tableId:r.tableId}}).done(function(e){var t=$.map(e,function(e,t){var a=$.grep(o.SelectedFields(),function(o){return o.fieldId==e.fieldId});return a.length>0?a[0]:(e.tableName=r.tableName,o.setupField(e))});o.ChooseFields(t)}):o.ChooseFields([])}),o.MoveChosenFields=function(){$.each(o.ChosenFields(),function(e,r){$.grep(o.SelectedFields(),function(e){return e.fieldId==r.fieldId}).length>0?toastr.error(r.fieldName+" is already Selected"):o.SelectedFields.push(r)})},o.MoveAllFields=function(){$.each(o.ChooseFields(),function(e,r){0===$.grep(o.SelectedFields(),function(e){return e.fieldId==r.fieldId}).length&&o.SelectedFields.push(r)})},o.RemoveSelectedFields=function(){$.each(o.ChooseFields(),function(e,r){o.SelectedFields.remove(r)})},o.isFieldValidForYAxis=function(e,r){return!(e>0&&"Bar"==o.ReportType()&&["Int","Double","Money"].indexOf(r)<0)},o.isChart=ko.computed(function(){return["List","Summary"].indexOf(o.ReportType())<0}),o.isFieldValidForSubGroup=function(e,o){return!(e>0&&["Int","Double","Money"].indexOf(o)<0)},o.canDrilldown=ko.computed(function(){return["List"].indexOf(o.ReportType())<0}),o.dateFields=ko.computed(function(){return $.grep(o.SelectedFields(),function(e){return"DateTime"==e.fieldType})}),o.canAddSeries=ko.computed(function(){var e=o.dateFields().length>0&&["Bar","Line"].indexOf(o.ReportType())>=0,r=$.grep(o.Filters(),function(e){return"range"==e.Operator()&&e.Value()&&0==e.Value().indexOf("This")}).length>0;return e&&r}),o.canAddSeries.subscribe(function(e){e||o.AdditionalSeries([])}),o.AddSeries=function(e){e=e||{};var r=ko.observable();e.FieldId?r(o.FindField(e.FieldId)):r(o.dateFields()[0]);var t=ko.observableArray([]);function a(e){t("This Year"==e?["Last Year","2 Years ago","3 Years ago","4 Years ago","5 Years ago"]:"This Month"==e?["Last Month","2 Months ago","3 Months ago","4 Months ago","5 Months ago"]:"This Week"==e?["Last Week","2 Weeks ago","3 Weeks ago","4 Weeks ago","5 Weeks ago"]:[])}$.each(o.Filters(),function(e,o){if(o.Field().FieldId==r().FieldId)return a(o.Value()),o.Value.subscribe(function(e){a(e)}),!1}),o.AdditionalSeries.push({Field:r,Operator:ko.observable("Range"),Value:ko.observable(e.Value),Range:t})},o.canMoveUp=function(){return 1==o.SelectFields().length&&o.SelectedFields.indexOf(o.SelectFields()[0])>=1},o.canMoveDown=function(){return 1==o.SelectFields().length&&o.SelectedFields.indexOf(o.SelectFields()[0])<o.SelectedFields().length-1},o.MoveUp=function(){if(o.canMoveUp()){var e=o.SelectFields()[0],r=o.SelectedFields.indexOf(e);if(r>=1){var t=o.SelectedFields();o.SelectedFields.splice(r-1,2,t[r],t[r-1])}}},o.MoveDown=function(){if(o.canMoveDown()){var e=o.SelectFields()[0],r=o.SelectedFields.indexOf(e),t=o.SelectedFields();r<t.length-1&&o.SelectedFields.splice(r,2,t[r+1],t[r])}},o.AddFilter=function(r,t){r=r||{};var a=ko.observableArray([]);r.Value1&&a.push({id:r.Value1,text:r.Value1}),r.Value2&&a.push({id:r.Value2,text:r.Value2});var n=ko.observable();n.subscribe(function(o){o&&o.hasForeignKey&&ajaxcall({url:e.apiUrl+"/ReportApi/GetLookupList",data:{account:e.accountApiToken,dataConnect:e.dataconnectApiToken,clientId:e.clientId,fieldId:o.fieldId}}).done(function(o){ajaxcall({type:"POST",url:e.lookupListUrl,data:JSON.stringify({lookupSql:o.sql,connectKey:o.connectKey})}).done(function(e){e.d&&(e=e.d),a(e)})})}),r.FieldId&&n(o.FindField(r.FieldId)),o.Filters.push({AndOr:ko.observable(t?" AND ":r.AndOr),Field:n,Operator:ko.observable(r.Operator),Value:ko.observable(r.Value1),Value2:ko.observable(r.Value2),LookupList:a,Apply:ko.observable(null==r.Apply||r.Apply),IsFilterOnFly:!0===t})},o.RemoveField=function(e){o.SelectedFields.remove(e)},o.RemoveFilter=function(e){o.Filters.remove(e)},o.RemoveSeries=function(e){o.AdditionalSeries.remove(e)},o.FindField=function(e){return $.grep(o.SelectedFields(),function(o){return o.fieldId==e})[0]},o.SaveWithoutRun=function(){o.RunReport(!0)},o.BuildReportData=function(e){return e=e||[],{ReportID:o.ReportID(),ReportName:o.ReportName(),ReportDescription:o.ReportDescription(),FolderID:o.FolderID(),SelectedFieldIDs:$.map(o.SelectedFields(),function(e){return e.fieldId}),Filters:$.map(o.Filters(),function(e,r){var t=e.Apply()&&e.IsFilterOnFly||!e.IsFilterOnFly?{SavedReportId:o.ReportID(),FieldId:e.Field().fieldId,AndOr:e.AndOr(),Operator:e.Operator(),Value1:Array.isArray(e.Value())&&"in"==e.Operator()?e.Value().join(","):e.Value(),Value2:e.Value2()}:null;return null==t||t.Value1||t.Value2||(t=null),t}),Series:$.map(o.AdditionalSeries(),function(e,r){return{SavedReportId:o.ReportID(),FieldId:e.Field().fieldId,Operator:e.Operator(),Value:e.Value()}}),IncludeSubTotals:o.IncludeSubTotal(),ShowUniqueRecords:o.ShowUniqueRecords(),IsAggregateReport:!(e.length>0)&&o.AggregateReport(),ShowDataWithGraph:o.ShowDataWithGraph(),ShowOnDashboard:o.ShowOnDashboard(),SortBy:o.SortByField(),ReportType:o.ReportType(),GroupFunctionList:$.map(o.SelectedFields(),function(e){return{FieldID:e.fieldId,GroupFunc:e.selectedAggregate(),FilterOnFly:e.filterOnFly(),Disabled:e.disabled(),GroupInGraph:e.groupInGraph(),HideInDetail:e.hideInDetail()}}),DrillDownRow:e}},o.RunReport=function(r){r=!0===r,o.validateReport()?ajaxcall({url:e.apiUrl+"/ReportApi/RunReport",type:"POST",data:JSON.stringify({Account:e.accountApiToken,dataConnect:e.dataconnectApiToken,clientId:e.clientId,SaveReport:!!o.CanSaveReports()&&o.SaveReport(),ReportJson:JSON.stringify(o.BuildReportData()),userId:e.userId})}).done(function(t){o.ReportID(t.reportId),o.SaveReport()&&(toastr.success("Report Saved"),r&&o.LoadAllSavedReports()),r||("execute"==o.ReportMode()||"dashboard"==o.ReportMode()?o.ExecuteReportQuery(t.sql,t.connectKey):redirectToReport(e.runReportUrl,{reportId:t.reportId,reportName:o.ReportName(),reportDescription:o.ReportDescription(),includeSubTotal:o.IncludeSubTotal(),showUniqueRecords:o.ShowUniqueRecords(),aggregateReport:o.AggregateReport(),showDataWithGraph:o.ShowDataWithGraph(),reportSql:t.sql,connectKey:t.connectKey,reportFilter:JSON.stringify($.map(o.FlyFilters(),function(e){return ko.toJS(e)})),reportType:o.ReportType(),selectedFolder:null!=o.SelectedFolder()?o.SelectedFolder().Id:0}))}):toastr.error("Please correct validation issues")},o.ExecuteReportQuery=function(r,t){r&&t&&ajaxcall({url:e.execReportUrl,type:"POST",data:JSON.stringify({reportSql:r,connectKey:t,reportType:o.ReportType(),pageNumber:o.pager.currentPage(),pageSize:o.pager.pageSize(),sortBy:o.pager.sortColumn()||"",desc:o.pager.sortDescending()||!1})}).done(function(a){a.d&&(a=a.d);var n=o.ReportResult();n.HasError(a.HasError),n.Exception(a.Exception),n.Warnings(a.Warnings),n.ReportDebug(a.ReportDebug),n.ReportSql(a.ReportSql),a.ReportData.IsDrillDown=ko.observable(!1),$.each(a.ReportData.Rows,function(r,t){t.DrillDownData=ko.observable(null),t.pager=new pagerViewModel({pageSize:10}),t.sql="",t.connectKey="",t.changeSort=function(e){return t.pager.changeSort(e),t.execute(),!1},t.isExpanded=ko.observable(!1),t.execute=function(){""!=t.sql&&ajaxcall({url:e.execReportUrl,type:"POST",data:JSON.stringify({reportSql:t.sql,connectKey:t.connectKey,reportType:"List",pageNumber:t.pager.currentPage(),pageSize:t.pager.pageSize(),sortBy:t.pager.sortColumn()||"",desc:t.pager.sortDescending()||!1})}).done(function(e){e.d&&(e=e.d),e.ReportData.IsDrillDown=ko.observable(!0),t.DrillDownData(e.ReportData),t.pager.totalRecords(e.Pager.TotalRecords),t.pager.pages(e.Pager.TotalPages)})},t.expand=function(){ajaxcall({url:e.apiUrl+"/ReportApi/RunDrillDownReport",type:"POST",data:JSON.stringify({Account:e.accountApiToken,dataConnect:e.dataconnectApiToken,clientId:e.clientId,SaveReport:!1,ReportJson:JSON.stringify(o.BuildReportData(t.Items)),userId:e.userId})}).done(function(e){t.sql=e.sql,t.connectKey=e.connectKey,t.execute()}),t.isExpanded(!0)},t.pager.currentPage.subscribe(function(){t.execute()}),t.collapse=function(){t.isExpanded(!1)},t.toggle=function(){t.isExpanded()?t.collapse():t.expand()}}),n.ReportData(a.ReportData),o.pager.totalRecords(a.Pager.TotalRecords),o.pager.pages(a.Pager.TotalPages),o.currentSql(r),o.currentConnectKey(t),a.Warnings&&toastr.info("Note: "+a.Warnings),o.isChart()&&(google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback(o.DrawChart))})},o.ExpandAll=function(){$.each(o.ReportResult().ReportData().Rows,function(e,o){o.expand()})},o.CollapseAll=function(){$.each(o.ReportResult().ReportData().Rows,function(e,o){o.collapse()})},o.DrawChart=function(){if(o.isChart()){var e=o.ReportResult().ReportData(),r=new google.visualization.DataTable,t=[],a=[];$.each(e.Columns,function(e,n){var l=o.SelectedFields()[e];0==e?r.addColumn(n.IsNumeric?"number":"string",n.ColumnName):l.groupInGraph()?t.push({index:e,column:n.ColumnName}):n.IsNumeric&&a.push({index:e,column:n.ColumnName})}),0==t.length&&$.each(e.Columns,function(e,o){e>0&&o.IsNumeric&&r.addColumn(o.IsNumeric?"number":"string",o.ColumnName)});var n=[],l=[];$.each(e.Rows,function(e,o){var i=[];$.each(o.Items,function(e,o){if(0==e)t.length>0&&(i=$.grep(n,function(e){return e[0]==o.Value})).length>0?(n=n.filter(function(e){return e[0]!=o.Value}),i=i[0]):i.push(o.Column.IsNumeric?parseInt(o.Value):o.Value);else if(t.length>0){1==$.grep(t,function(o){return o.index==e}).length?0==$.grep(l,function(e){return e==o.Value}).length&&(l.push(o.Value),$.each(a,function(e,t){r.addColumn("number",o.Value+(0==e?"":"-"+e))})):o.Column.IsNumeric&&i.push(o.Column.IsNumeric?parseInt(o.Value):o.Value)}else o.Column.IsNumeric&&i.push(o.Column.IsNumeric?parseInt(o.Value):o.Value)}),n.push(i)}),$.each(n,function(e,o){if(o.length!=r.getNumberOfColumns())for(var t=0;t<=r.getNumberOfColumns()-o.length;t++)o.push(0)}),r.addRows(n);var i={title:o.ReportName()},d=document.getElementById("chart_div_"+o.ReportID()),c=null;"Pie"==o.ReportType()&&(c=new google.visualization.PieChart(d)),"Bar"==o.ReportType()&&(c=new google.visualization.ColumnChart(d)),"Line"==o.ReportType()&&(c=new google.visualization.LineChart(d)),c.draw(r,i)}},o.loadFolders=function(r){ajaxcall({url:e.apiUrl+"/ReportApi/GetFolders",data:{account:e.accountApiToken,dataConnect:e.dataconnectApiToken,clientId:e.clientId,userId:e.userId}}).done(function(e){if(o.Folders(e),o.SelectedFolder(null),r){var t=$.grep(e,function(e){return e.Id==r});t.length>0&&o.SelectedFolder(t[0])}})},o.setupField=function(e){return e.selectedFieldName=e.tableName+" > "+e.fieldName,e.selectedAggregate=ko.observable(e.aggregateFunction),e.filterOnFly=ko.observable(e.filterOnFly),e.disabled=ko.observable(e.disabled),e.groupInGraph=ko.observable(e.groupInGraph),e.hideInDetail=ko.observable(e.hideInDetail),e.fieldAggregateWithDrilldown=e.fieldAggregate.concat("Only in Detail"),e},o.LoadReport=function(r,t){return ajaxcall({url:e.apiUrl+"/ReportApi/LoadReport",data:{account:e.accountApiToken,dataConnect:e.dataconnectApiToken,clientId:e.clientId,reportId:r,userId:e.userId}}).done(function(r){o.ReportID(r.ReportID),o.ReportType(r.ReportType),o.ReportName(r.ReportName),o.ReportDescription(r.ReportDescription),o.FolderID(r.FolderID),$.each(r.SelectedFields,function(e,r){r=o.setupField(r)}),o.SelectedFields(r.SelectedFields),o.ChosenFields([]),o.SelectFields([]),o.SelectedField(null),o.IncludeSubTotal(r.IncludeSubTotals),o.ShowUniqueRecords(r.ShowUniqueRecords),o.AggregateReport(r.IsAggregateReport),o.ShowDataWithGraph(r.ShowDataWithGraph),o.ShowOnDashboard(r.ShowOnDashboard),o.SortByField(r.SortBy),o.Filters([]),o.AdditionalSeries([]);var a=[];function n(){$.each(r.Filters,function(e,r){if(a.indexOf(r.FieldId)<0){var t=$.grep(o.SelectedFields(),function(e){return 1==e.filterOnFly()&&e.fieldId==r.FieldId});t&&a.push(r.FieldId),o.AddFilter(r,t)}})}if(1==t){if(e.reportFilter&&"[]"!=e.reportFilter){var l=JSON.parse(e.reportFilter);$.each(l,function(e,r){a.indexOf(r.Field.fieldId)<0&&(r.FieldId=r.Field.fieldId,r.Value1=r.Value,a.push(r.FieldId),o.AddFilter(r,!0))})}n(),$.each($.grep(o.SelectedFields(),function(e){return 1==e.filterOnFly()&&a.indexOf(e.fieldId)<0}),function(e,r){o.AddFilter(null,!0),o.Filters()[o.Filters().length-1].Field(r)})}else n();$.each(r.Series,function(e,r){o.AddSeries(r)}),o.SaveReport(!t),"execute"!=o.ReportMode()&&"dashboard"!=o.ReportMode()||o.ExecuteReportQuery(e.reportSql,e.reportConnect)})},o.LoadAllSavedReports=function(){ajaxcall({url:e.apiUrl+"/ReportApi/GetSavedReports",data:{account:e.accountApiToken,dataConnect:e.dataconnectApiToken,clientId:e.clientId,userId:e.userId}}).done(function(r){$.each(r,function(r,t){t.runMode=!1,t.openReport=function(){o.LoadReport(t.reportId).done(function(){t.runMode?(o.SaveReport(!1),o.RunReport(),t.runMode=!1):o.ReportMode("generate")})},t.runReport=function(){t.runMode=!0,t.openReport()},t.deleteReport=function(){bootbox.confirm("Are you sure you would like to Delete this Report?",function(r){r&&ajaxcall({url:e.apiUrl+"/ReportApi/DeleteReport",data:{account:e.accountApiToken,dataConnect:e.dataconnectApiToken,clientId:e.clientId,reportId:t.reportId,userId:e.userId}}).done(function(){o.SavedReports.remove(t)})})},e.reportId>0&&t.reportId==e.reportId&&(t.openReport(),e.reportWizard.modal("show"))}),o.SavedReports(r)})},"dashboard"!=o.ReportMode()&&(o.LoadAllSavedReports(),ajaxcall({url:e.apiUrl+"/ReportApi/CanSaveReports",data:{account:e.accountApiToken,dataConnect:e.dataconnectApiToken,clientId:e.clientId}}).done(function(e){e=e||{allowUsersToCreateReports:!0,allowUsersToManageFolders:!0},o.CanSaveReports(e.allowUsersToCreateReports),o.CanManageFolders(e.allowUsersToManageFolders)})),o.changeSort=function(e){return o.pager.changeSort(e),o.ExecuteReportQuery(o.currentSql(),o.currentConnectKey()),!1},o.isInputValid=function(e){return(null==$(e).attr("data-notempty")||0!=$(e).children("option").length)&&(e.validity?e.validity.valid:null==$(e).attr("required")||""!=$(e).val())},o.validateReport=function(){if(null!=e.reportWizard){var r=e.reportWizard.find("input,select"),t=!0;$(".form-group").removeClass("has-error");for(var a=0;a<r.length;a++)o.isInputValid(r[a])||(t=!1,$(r[a]).closest(".form-group").addClass("has-error"));return t}},o.loadTables=function(){ajaxcall({url:e.apiUrl+"/ReportApi/GetTables",data:{account:e.accountApiToken,dataConnect:e.dataconnectApiToken,clientId:e.clientId}}).done(function(e){o.Tables(e)})},o.init=function(e){o.loadFolders(e),o.loadTables()}},dashboardViewModel=function(e){var o=this;o.reports=ko.observableArray([]),$.each(e.reports,function(r,t){var a=new reportViewModel({runReportUrl:e.runReportUrl,execReportUrl:e.execReportUrl,reportWizard:e.reportWizard,lookupListUrl:e.lookupListUrl,apiUrl:e.apiUrl,accountApiToken:e.accountApiToken,dataconnectApiToken:e.dataconnectApiToken,reportFilter:t.reportFilter,reportMode:"dashboard",reportSql:t.reportSql,reportId:t.reportId,reportConnect:t.connectKey});o.reports.push(a),a.LoadReport(t.reportId,!0)}),o.drawChart=function(){$.each(o.reports(),function(e,o){o.DrawChart()})}};